/*
 * A class, comprised of multiple SoundPlayers, that provides methods for
 * smoother and more robust game audio in the form of an "init, loop, tail(s)"
 * scheme.
 *
 */

namespace Sup {
    export namespace Audio {
        export class MultiSoundPlayer {
            init: SoundPlayer;
            loop: SoundPlayer;
            tails: Array<any>;
            soundPlayers: any;
            volume: number;
            playMode: string; // init, loop, tail

            /*
                Constructs a MultiSoundPlayer.
            */
            constructor(init: string|Sound, loop: string|Sound, tails: Array<any>, volume=1.0, options?: { loop?: boolean; pitch?: number; pan?: number; }) {
                this.init = new SoundPlayer(init, volume, options);
                this.loop = new SoundPlayer(loop, volume, {loop: true});

                // for multiple tails corresponding to multiple beats
                this.tails = [];

                for (var i = 0; i < tails.length; i++) {
                    let tailAudio = new SoundPlayer(tails[i].audio, volume, options);
                    let beat = tails[i].beat;
                    this.tails.push({
                        audio: tailAudio,
                        beat: beat
                    });
                }

                this.volume = volume;

                this.soundPlayers = {
                    init: this.init,
                    loop: this.loop,
                    tails: this.tails
                };

                this.playMode = "init";
            }

            /*
                Play the appropriate sound (init, loop, or tail).
            */
            play(beatNum=0) {
                if (this.playMode != "tail") {
                    this.soundPlayers[this.playMode].play();
                }
                else {
                    this.soundPlayers["tails"][beatNum].play();
                }
            }
        }
    }
}